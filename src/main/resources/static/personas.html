<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Gestión de Personas</title>
</head>
<body>
<h1>Gestión de Personas</h1>

<h2>Agregar Persona</h2>
<input type="number" id="id" placeholder="ID">
<input type="text" id="nombre" placeholder="Nombre">
<input type="email" id="gmail" placeholder="Gmail">
<button onclick="crearPersona()">Agregar</button>

<h2>Actualizar Persona</h2>
<input type="number" id="updId" placeholder="ID a actualizar">
<input type="text" id="updNombre" placeholder="Nuevo Nombre">
<input type="email" id="updGmail" placeholder="Nuevo Gmail">
<button onclick="actualizarPersona()">Actualizar</button>

<h2>Modificar Parcialmente</h2>
<input type="number" id="patchId" placeholder="ID a modificar">
<input type="text" id="patchNombre" placeholder="Nuevo Nombre (opcional)">
<input type="email" id="patchGmail" placeholder="Nuevo Gmail (opcional)">
<button onclick="modificarParcial()">Modificar</button>

<h2>Eliminar Persona</h2>
<input type="number" id="delId" placeholder="ID a eliminar">
<button onclick="eliminarPersona()">Eliminar</button>

<h2>Lista de Personas</h2>
<button onclick="cargarPersonas()">Cargar Personas</button>
<ul id="listaPersonas"></ul>

<script>
    const url = '/personas';

    function cargarPersonas() {
        fetch(url)
            .then(res => res.json())
            .then(data => {
                const lista = document.getElementById("listaPersonas");
                lista.innerHTML = "";
                data.forEach(p => {
                    const li = document.createElement("li");
                    li.textContent = `ID: ${p.id} - Nombre: ${p.nombre} - Gmail: ${p.gmail}`;
                    lista.appendChild(li);
                });
            });
    }

    function crearPersona() {
    const id = document.getElementById("id").value;
    const nombre = document.getElementById("nombre").value;
    const gmail = document.getElementById("gmail").value;

    fetch(url, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({id: Number(id), nombre, gmail})
    })
    .then(response => {
        if (response.ok) {
            // limpiar inputs y recargar lista
            document.getElementById("id").value = "";
            document.getElementById("nombre").value = "";
            document.getElementById("gmail").value = "";
            cargarPersonas();
        } else {
            alert("Error al agregar persona. Revisa los datos.");
        }
    });
}


    function actualizarPersona() {
        const id = document.getElementById("updId").value;
        const nombre = document.getElementById("updNombre").value;
        const gmail = document.getElementById("updGmail").value;

        fetch(`${url}/${id}`, {
            method: 'PUT',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({id: Number(id), nombre, gmail})
        }).then(() => cargarPersonas());
    }

    function modificarParcial() {
        const id = document.getElementById("patchId").value;
        const nombre = document.getElementById("patchNombre").value;
        const gmail = document.getElementById("patchGmail").value;

        const parcial = {};
        if (nombre) parcial.nombre = nombre;
        if (gmail) parcial.gmail = gmail;

        fetch(`${url}/${id}`, {
            method: 'PATCH',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(parcial)
        }).then(() => cargarPersonas());
    }

    function eliminarPersona() {
        const id = document.getElementById("delId").value;
        fetch(`${url}/${id}`, {
            method: 'DELETE'
        }).then(() => cargarPersonas());
    }
</script>
</body>
</html>
